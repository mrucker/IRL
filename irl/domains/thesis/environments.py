import random

from itertools import product, chain
from typing import Sequence, Tuple, Any

import torch
import numpy as np
from gym.envs.registration import register
from gym.spaces import Box

from combat.environments import GymEnvironment, RewardEnvironment, SimEnvironment 
from combat.representations import LambdaReward, Observation
from combat.domains.thesis.representations import RewardFeatures, ValueFeatures, GameState, RandomReward

class ThesisDynamics(SimEnvironment):

    def __init__(self):
        
        base = [-150,-100,-75,-50,-25,-10,-8,-5,-2,0,2,5,8,10,25,50,75,100,150]

        self._random         = random.Random()
        self._initial_states = None #[ s for e in agent_episodes.values() for s in e.states[:-1] ]
        self._base_actions   = torch.tensor(list(product(base,base)))

        self._B = torch.tensor([
            [1,0],
            [0,1],
            [1,0],
            [0,1],
            [1,0],
            [0,1],
            [1,0],
            [0,1],
        ]).float()

        self._A = -torch.tensor([
            [0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0],
            [1,0,0,0,0,0,0,0],
            [0,1,0,0,0,0,0,0],
            [1,0,1,0,0,0,0,0],
            [0,1,0,1,0,0,0,0],
            [1,0,1,0,1,0,0,0],
            [0,1,0,1,0,1,0,0],
        ]).float()

        self._D = torch.distributions.Binomial(total_count=33, probs=1/200)

        self._init_states = self._read_states_from_file("../../data/thesis/trajectory.json")

    def reset(self):
        self._state = self._random.choice(self._init_states)
        return self._state

    def actions(self) -> Sequence[int]:
        return list(range(len(self._base_actions)))

    def step(self, action: int) -> Tuple[Observation, float, bool, Any]:

        base_action = self._base_actions[action]

        next_cursor_state   = self._update_old_cursor(self._state[0:8], [base_action])[0]
        updated_old_targets = self._update_old_targets(self._state.targets)
        updated_new_targets = self._update_new_targets(self._state.width, self._state.height, self._state.radius)

        next_targets = updated_old_targets+updated_new_targets

        self._state = GameState(*next_cursor_state.tolist(), *self._state[8:11], next_targets)

        observation  = self._state
        reward       = None
        is_terminal  = False
        info         = {}

        return observation, reward, is_terminal, info

    def seed(self, seed: int) -> None:
        self._random = random.Random(seed)

    def _update_old_cursor(self, cursor_states, actions):

        if isinstance(actions, list): 
            
            if isinstance(actions[0],np.ndarray):
                actions = list(map(torch.tensor,actions))

            actions = torch.vstack(actions)

        x = torch.tensor([cursor_states]).float()
        u = actions.float()

        new_cursor_states = (self._A @ x.T + self._B @ (x[:,0:2] + u).T).T

        return new_cursor_states

    def _update_old_targets(self, target_state):

        xs = target_state[0::3]
        ys = target_state[1::3]
        ts = [ t + 33 for t in target_state[2::3] if t+33 < 1000 ]

        return tuple(chain.from_iterable(zip(xs, ys, ts)))

    def _update_new_targets(self, width, height, radius):

        n_targets_to_create = int(self._D.sample())

        if n_targets_to_create == 0:
            return ()
        
        new_targets_rands = torch.rand(n_targets_to_create,2)
        new_targets_scale = torch.diag(torch.tensor([(width  - radius*2), (height - radius*2)])).float()

        new_targets_point = (new_targets_rands @ new_targets_scale).int()
        new_targets_age   = 10 * torch.ones(n_targets_to_create,1) #we make age 10 because 10+(33*30) = 1000

        return tuple(torch.hstack([new_targets_point, new_targets_age]).reshape(-1).tolist())

    def _read_states_from_file(self, file:str):

        observations = [[1173,693,3175,1535,156],[1160,683,3175,1535,156],[1153,675,3175,1535,156],[1145,673,3175,1535,156],[1138,673,3175,1535,156,626,555,22],[1138,673,3175,1535,156,626,555,56],[1138,673,3175,1535,156,626,555,87],[1143,673,3175,1535,156,626,555,121,2249,305,25],[1158,673,3175,1535,156,626,555,155,2249,305,60],[1163,673,3175,1535,156,626,555,187,2249,305,91],[1175,685,3175,1535,156,626,555,223,2249,305,127],[1180,685,3175,1535,156,626,555,255,2249,305,159],[1218,693,3175,1535,156,626,555,289,2249,305,193],[1245,700,3175,1535,156,626,555,321,2249,305,225],[1278,700,3175,1535,156,626,555,353,2249,305,258],[1280,700,3175,1535,156,626,555,388,2249,305,292],[1265,695,3175,1535,156,626,555,422,2249,305,326,0,0,5],[1175,658,3175,1535,156,626,555,453,2249,305,357,1895,1165,36],[955,633,3175,1535,156,626,555,489,2249,305,393,1895,1165,72],[863,633,3175,1535,156,626,555,520,2249,305,424,1895,1165,103],[775,633,3175,1535,156,626,555,553,2249,305,457,1895,1165,136],[698,630,3175,1535,156,626,555,589,2249,305,493,1895,1165,172,0,0,5],[668,625,3175,1535,156,626,555,628,2249,305,532,1895,1165,211,2847,278,44],[665,625,3175,1535,156,626,555,653,2249,305,557,1895,1165,236,2847,278,69],[665,625,3175,1535,156,626,555,689,2249,305,593,1895,1165,272,2847,278,105],[668,625,3175,1535,156,626,555,728,2249,305,632,1895,1165,311,2847,278,144,0,0,0],[673,625,3175,1535,156,626,555,755,2249,305,659,1895,1165,338,2847,278,171,0,0,27],[755,600,3175,1535,156,626,555,786,2249,305,690,1895,1165,369,2847,278,202,2941,1297,58],[1260,588,3175,1535,156,626,555,829,2249,305,733,1895,1165,412,2847,278,245,2941,1297,101],[1425,595,3175,1535,156,626,555,855,2249,305,759,1895,1165,438,2847,278,271,2941,1297,127],[1873,583,3175,1535,156,626,555,888,2249,305,792,1895,1165,471,2847,278,304,2941,1297,160,0,0,15],[2155,498,3175,1535,156,626,555,920,2249,305,824,1895,1165,503,2847,278,336,2941,1297,192,2701,465,47],[2358,345,3175,1535,156,626,555,953,2249,305,857,1895,1165,536,2847,278,369,2941,1297,225,2701,465,80],[2515,190,3175,1535,156,626,555,986,2249,305,890,1895,1165,569,2847,278,402,2941,1297,258,2701,465,113],[2565,148,3175,1535,156,626,555,1024,2249,305,928,1895,1165,607,2847,278,440,2941,1297,296,2701,465,151],[2573,143,3175,1535,156,2249,305,960,1895,1165,639,2847,278,472,2941,1297,328,2701,465,183],[2573,143,3175,1535,156,2249,305,994,1895,1165,673,2847,278,506,2941,1297,362,2701,465,217],[2573,143,3175,1535,156,1895,1165,706,2847,278,539,2941,1297,395,2701,465,250],[2565,180,3175,1535,156,1895,1165,737,2847,278,570,2941,1297,426,2701,465,281],[2498,298,3175,1535,156,1895,1165,769,2847,278,602,2941,1297,458,2701,465,313],[2415,405,3175,1535,156,1895,1165,802,2847,278,635,2941,1297,491,2701,465,346],[2353,495,3175,1535,156,1895,1165,840,2847,278,673,2941,1297,529,2701,465,384],[2275,605,3175,1535,156,1895,1165,871,2847,278,704,2941,1297,560,2701,465,415],[2198,718,3175,1535,156,1895,1165,905,2847,278,738,2941,1297,594,2701,465,449],[2128,813,3175,1535,156,1895,1165,936,2847,278,769,2941,1297,625,2701,465,480],[2065,898,3175,1535,156,1895,1165,972,2847,278,805,2941,1297,661,2701,465,516],[2018,988,3175,1535,156,1895,1165,1004,2847,278,837,2941,1297,693,2701,465,548],[1993,1045,3175,1535,156,2847,278,870,2941,1297,726,2701,465,581],[1988,1053,3175,1535,156,2847,278,902,2941,1297,758,2701,465,613],[2060,990,3175,1535,156,2847,278,935,2941,1297,791,2701,465,646],[2378,563,3175,1535,156,2847,278,972,2941,1297,828,2701,465,683],[2605,218,3175,1535,156,2941,1297,866,2701,465,721],[2650,183,3175,1535,156,2941,1297,896,2701,465,751],[2675,165,3175,1535,156,2941,1297,928,2701,465,783],[2678,163,3175,1535,156,2941,1297,962,2701,465,817],[2678,163,3175,1535,156,2941,1297,996,2701,465,851],[2683,168,3175,1535,156,2941,1297,1027,2701,465,882],[2698,213,3175,1535,156,2701,465,914],[2703,273,3175,1535,156,2701,465,946],[2675,368,3175,1535,156,2701,465,980],[2658,403,3175,1535,156,2701,465,1015],[2653,410,3175,1535,156],[2653,420,3175,1535,156,0,0,20,0,0,4],[2653,433,3175,1535,156,2792,459,57,2695,422,41],[2655,488,3175,1535,156,2792,459,88,2695,422,72],[2653,545,3175,1535,156,2792,459,122,2695,422,106],[2653,545,3175,1535,156,2792,459,156,2695,422,140],[2653,545,3175,1535,156,2792,459,189,2695,422,173],[2653,545,3175,1535,156,2792,459,223,2695,422,207],[2653,545,3175,1535,156,2792,459,259,2695,422,243],[2653,545,3175,1535,156,2792,459,287,2695,422,271,2672,354,28],[2653,545,3175,1535,156,2792,459,323,2695,422,307,2672,354,64],[2653,545,3175,1535,156,2792,459,356,2695,422,340,2672,354,97],[2653,545,3175,1535,156,2792,459,391,2695,422,375,2672,354,132],[2653,545,3175,1535,156,2792,459,424,2695,422,408,2672,354,165],[2658,545,3175,1535,156,2792,459,457,2695,422,441,2672,354,198],[2730,538,3175,1535,156,2792,459,489,2695,422,473,2672,354,230],[2813,563,3175,1535,156,2792,459,523,2695,422,507,2672,354,264],[2885,613,3175,1535,156,2792,459,554,2695,422,538,2672,354,295],[2903,628,3175,1535,156,2792,459,589,2695,422,573,2672,354,330],[2905,628,3175,1535,156,2792,459,624,2695,422,608,2672,354,365,0,0,30,0,0,23],[2905,628,3175,1535,156,2792,459,653,2695,422,637,2672,354,394,1687,572,59,2724,709,52,0,0,22],[2853,545,3175,1535,156,2792,459,689,2695,422,673,2672,354,430,1687,572,96,2724,709,89,1768,213,59],[2695,265,3175,1535,156,2792,459,724,2695,422,708,2672,354,465,1687,572,130,2724,709,123,1768,213,93],[2643,158,3175,1535,156,2792,459,758,2695,422,742,2672,354,499,1687,572,164,2724,709,157,1768,213,127,0,0,30],[2633,143,3175,1535,156,2792,459,787,2695,422,771,2672,354,528,1687,572,193,2724,709,186,1768,213,156,1009,1119,59],[2630,143,3175,1535,156,2792,459,823,2695,422,807,2672,354,565,1687,572,230,2724,709,223,1768,213,193,1009,1119,96],[2628,148,3175,1535,156,2792,459,852,2695,422,836,2672,354,593,1687,572,258,2724,709,251,1768,213,221,1009,1119,124],[2618,175,3175,1535,156,2792,459,888,2695,422,872,2672,354,629,1687,572,294,2724,709,287,1768,213,257,1009,1119,160],[2613,228,3175,1535,156,2792,459,923,2695,422,907,2672,354,664,1687,572,329,2724,709,326,1768,213,296,1009,1119,199],[2613,270,3175,1535,156,2792,459,954,2695,422,938,2672,354,695,1687,572,360,2724,709,353,1768,213,323,1009,1119,226],[2618,383,3175,1535,156,2792,459,987,2695,422,971,2672,354,728,1687,572,393,2724,709,386,1768,213,356,1009,1119,259],[2628,438,3175,1535,156,2792,459,1022,2695,422,1006,2672,354,763,1687,572,428,2724,709,421,1768,213,391,1009,1119,294],[2668,548,3175,1535,156,2672,354,797,1687,572,462,2724,709,455,1768,213,425,1009,1119,328],[2703,625,3175,1535,156,2672,354,827,1687,572,492,2724,709,485,1768,213,455,1009,1119,358],[2718,658,3175,1535,156,2672,354,863,1687,572,528,2724,709,521,1768,213,491,1009,1119,394],[2718,685,3175,1535,156,2672,354,896,1687,572,561,2724,709,554,1768,213,524,1009,1119,427,0,0,8],[2693,735,3175,1535,156,2672,354,928,1687,572,593,2724,709,586,1768,213,556,1009,1119,459,703,633,40],[2613,803,3175,1535,156,2672,354,962,1687,572,627,2724,709,620,1768,213,590,1009,1119,493,703,633,74],[2498,828,3175,1535,156,2672,354,994,1687,572,659,2724,709,652,1768,213,622,1009,1119,525,703,633,106],[2163,668,3175,1535,156,1687,572,695,2724,709,688,1768,213,658,1009,1119,561,703,633,142,0,0,12],[2025,568,3175,1535,156,1687,572,726,2724,709,719,1768,213,689,1009,1119,592,703,633,173,703,453,43,0,0,19],[1928,488,3175,1535,156,1687,572,762,2724,709,755,1768,213,725,1009,1119,628,703,633,209,703,453,79,1562,960,55,1961,1230,36,0,0,26],[1858,418,3175,1535,156,1687,572,794,2724,709,787,1768,213,757,1009,1119,660,703,633,241,703,453,111,1562,960,87,1961,1230,68,1909,1014,58],[1823,373,3175,1535,156,1687,572,828,2724,709,821,1768,213,791,1009,1119,694,703,633,275,703,453,145,1562,960,121,1961,1230,102,1909,1014,92],[1810,363,3175,1535,156,1687,572,862,2724,709,855,1768,213,825,1009,1119,728,703,633,309,703,453,179,1562,960,155,1961,1230,136,1909,1014,126],[1803,358,3175,1535,156,1687,572,893,2724,709,886,1768,213,856,1009,1119,759,703,633,340,703,453,211,1562,960,187,1961,1230,168,1909,1014,158],[1793,355,3175,1535,156,1687,572,930,2724,709,923,1768,213,893,1009,1119,796,703,633,377,703,453,247,1562,960,223,1961,1230,204,1909,1014,194],[1778,333,3175,1535,156,1687,572,961,2724,709,954,1768,213,924,1009,1119,828,703,633,409,703,453,279,1562,960,255,1961,1230,236,1909,1014,226],[1740,285,3175,1535,156,1687,572,993,2724,709,986,1768,213,956,1009,1119,859,703,633,440,703,453,310,1562,960,286,1961,1230,267,1909,1014,257],[1730,298,3175,1535,156,1768,213,1005,1009,1119,908,703,633,489,703,453,359,1562,960,335,1961,1230,316,1909,1014,306,1015,705,44],[1728,310,3175,1535,156,1009,1119,926,703,633,507,703,453,377,1562,960,353,1961,1230,334,1909,1014,324,1015,705,62],[1723,433,3175,1535,156,1009,1119,961,703,633,542,703,453,412,1562,960,388,1961,1230,369,1909,1014,359,1015,705,97],[1718,543,3175,1535,156,1009,1119,994,703,633,575,703,453,445,1562,960,421,1961,1230,402,1909,1014,392,1015,705,130],[1703,608,3175,1535,156,703,633,608,703,453,478,1562,960,454,1961,1230,435,1909,1014,425,1015,705,163],[1695,618,3175,1535,156,703,633,639,703,453,509,1562,960,485,1961,1230,466,1909,1014,456,1015,705,194],[1695,628,3175,1535,156,703,633,674,703,453,544,1562,960,520,1961,1230,501,1909,1014,491,1015,705,229],[1690,725,3175,1535,156,703,633,709,703,453,579,1562,960,555,1961,1230,536,1909,1014,526,1015,705,264],[1678,893,3175,1535,156,703,633,741,703,453,611,1562,960,587,1961,1230,568,1909,1014,558,1015,705,296],[1655,993,3175,1535,156,703,633,774,703,453,644,1562,960,620,1961,1230,601,1909,1014,591,1015,705,329,1831,1133,22],[1648,1008,3175,1535,156,703,633,807,703,453,677,1562,960,653,1961,1230,634,1909,1014,624,1015,705,362,1831,1133,55],[1648,1010,3175,1535,156,703,633,842,703,453,712,1562,960,688,1961,1230,669,1909,1014,659,1015,705,397,1831,1133,90,2110,523,28],[1648,1010,3175,1535,156,703,633,874,703,453,744,1562,960,720,1961,1230,702,1909,1014,692,1015,705,430,1831,1133,123,2110,523,61],[1718,1008,3175,1535,156,703,633,907,703,453,777,1562,960,753,1961,1230,734,1909,1014,724,1015,705,462,1831,1133,155,2110,523,93],[1835,1053,3175,1535,156,703,633,943,703,453,813,1562,960,789,1961,1230,770,1909,1014,760,1015,705,498,1831,1133,191,2110,523,129],[1880,1078,3175,1535,156,703,633,976,703,453,846,1562,960,822,1961,1230,803,1909,1014,793,1015,705,531,1831,1133,224,2110,523,162,0,0,5],[1888,1088,3175,1535,156,703,453,877,1562,960,853,1961,1230,834,1909,1014,824,1015,705,562,1831,1133,255,2110,523,193,1197,891,36],[1888,1093,3175,1535,156,703,453,913,1562,960,889,1961,1230,870,1909,1014,860,1015,705,598,1831,1133,291,2110,523,229,1197,891,72],[1903,1128,3175,1535,156,703,453,945,1562,960,921,1961,1230,902,1909,1014,892,1015,705,630,1831,1133,323,2110,523,261,1197,891,104],[1933,1268,3175,1535,156,703,453,976,1562,960,952,1961,1230,933,1909,1014,923,1015,705,661,1831,1133,354,2110,523,292,1197,891,135,0,0,9],[1935,1338,3175,1535,156,1562,960,988,1961,1230,969,1909,1014,959,1015,705,697,1831,1133,390,2110,523,328,1197,891,171,352,271,45],[1935,1338,3175,1535,156,1961,1230,1001,1909,1014,991,1015,705,729,1831,1133,422,2110,523,360,1197,891,203,352,271,77],[1935,1338,3175,1535,156,1015,705,761,1831,1133,454,2110,523,392,1197,891,235,352,271,109],[1935,1338,3175,1535,156,1015,705,797,1831,1133,490,2110,523,428,1197,891,271,352,271,145],[1935,1338,3175,1535,156,1015,705,828,1831,1133,521,2110,523,459,1197,891,302,352,271,176,1095,682,30],[1935,1338,3175,1535,156,1015,705,862,1831,1133,555,2110,523,493,1197,891,336,352,271,210,1095,682,64],[1935,1338,3175,1535,156,1015,705,897,1831,1133,591,2110,523,529,1197,891,372,352,271,246,1095,682,100,1969,587,18],[1935,1338,3175,1535,156,1015,705,929,1831,1133,622,2110,523,560,1197,891,403,352,271,277,1095,682,131,1969,587,49,0,0,2],[1818,1298,3175,1535,156,1015,705,963,1831,1133,656,2110,523,594,1197,891,437,352,271,311,1095,682,165,1969,587,83,0,0,36],[1695,1263,3175,1535,156,1015,705,996,1831,1133,689,2110,523,627,1197,891,470,352,271,344,1095,682,198,1969,587,116,2698,780,69],[1463,1203,3175,1535,156,1831,1133,722,2110,523,660,1197,891,503,352,271,377,1095,682,231,1969,587,149,2698,780,102],[1398,1180,3175,1535,156,1831,1133,754,2110,523,692,1197,891,535,352,271,409,1095,682,263,1969,587,181,2698,780,134],[1328,1128,3175,1535,156,1831,1133,790,2110,523,728,1197,891,571,352,271,445,1095,682,299,1969,587,217,2698,780,170],[1265,1060,3175,1535,156,1831,1133,821,2110,523,759,1197,891,602,352,271,476,1095,682,330,1969,587,248,2698,780,201],[1190,965,3175,1535,156,1831,1133,856,2110,523,794,1197,891,637,352,271,511,1095,682,365,1969,587,283,2698,780,236],[1148,845,3175,1535,156,1831,1133,888,2110,523,826,1197,891,669,352,271,543,1095,682,397,1969,587,315,2698,780,268],[1140,693,3175,1535,156,1831,1133,921,2110,523,859,1197,891,702,352,271,576,1095,682,430,1969,587,348,2698,780,301],[1148,638,3175,1535,156,1831,1133,958,2110,523,896,1197,891,739,352,271,613,1095,682,467,1969,587,385,2698,780,338],[1148,633,3175,1535,156,1831,1133,991,2110,523,929,1197,891,772,352,271,646,1095,682,500,1969,587,418,2698,780,371],[1148,633,3175,1535,156,1831,1133,1026,2110,523,964,1197,891,807,352,271,681,1095,682,535,1969,587,453,2698,780,406],[1148,633,3175,1535,156,2110,523,993,1197,891,836,352,271,710,1095,682,565,1969,587,483,2698,780,436],[1148,633,3175,1535,156,1197,891,872,352,271,746,1095,682,600,1969,587,518,2698,780,471],[1148,633,3175,1535,156,1197,891,905,352,271,779,1095,682,633,1969,587,551,2698,780,504,0,0,13],[1225,640,3175,1535,156,1197,891,938,352,271,812,1095,682,666,1969,587,584,2698,780,537,2927,466,46],[1418,648,3175,1535,156,1197,891,971,352,271,845,1095,682,699,1969,587,617,2698,780,570,2927,466,79],[1643,603,3175,1535,156,1197,891,1002,352,271,876,1095,682,730,1969,587,648,2698,780,601,2927,466,110],[1785,575,3175,1535,156,352,271,909,1095,682,763,1969,587,681,2698,780,634,2927,466,143],[1858,563,3175,1535,156,352,271,948,1095,682,802,1969,587,720,2698,780,673,2927,466,182],[1883,563,3175,1535,156,352,271,977,1095,682,831,1969,587,749,2698,780,702,2927,466,211],[1888,563,3175,1535,156,1095,682,867,1969,587,785,2698,780,738,2927,466,247],[1888,563,3175,1535,156,1095,682,900,1969,587,818,2698,780,771,2927,466,280,497,521,16],[1888,568,3175,1535,156,1095,682,930,1969,587,848,2698,780,801,2927,466,310,497,521,46],[1895,575,3175,1535,156,1095,682,967,1969,587,885,2698,780,838,2927,466,347,497,521,83],[1923,588,3175,1535,156,1095,682,1000,1969,587,918,2698,780,871,2927,466,380,497,521,116],[1970,623,3175,1535,156,1969,587,950,2698,780,903,2927,466,412,497,521,148],[1988,638,3175,1535,156,1969,587,987,2698,780,940,2927,466,449,497,521,185],[1988,640,3175,1535,156,2698,780,971,2927,466,480,497,521,216],[1988,648,3175,1535,156,2698,780,1000,2927,466,509,497,521,245],[1988,655,3175,1535,156,2927,466,546,497,521,282],[1988,660,3175,1535,156,2927,466,579,497,521,315],[1983,663,3175,1535,156,2927,466,612,497,521,348],[1898,678,3175,1535,156,2927,466,642,497,521,378,410,1195,11],[1705,663,3175,1535,156,2927,466,679,497,521,415,410,1195,48],[1380,613,3175,1535,156,2927,466,710,497,521,446,410,1195,79],[1000,555,3175,1535,156,2927,466,746,497,521,482,410,1195,115],[713,523,3175,1535,156,2927,466,779,497,521,515,410,1195,148],[563,493,3175,1535,156,2927,466,814,497,521,550,410,1195,183],[485,468,3175,1535,156,2927,466,847,497,521,583,410,1195,216],[440,455,3175,1535,156,2927,466,877,497,521,613,410,1195,246],[415,455,3175,1535,156,2927,466,913,497,521,649,410,1195,282,0,0,11],[398,455,3175,1535,156,2927,466,946,497,521,682,410,1195,316,1234,263,45],[393,463,3175,1535,156,2927,466,977,497,521,713,410,1195,346,1234,263,75,0,0,7],[383,470,3175,1535,156,497,521,748,410,1195,381,1234,263,110,2903,796,42],[375,483,3175,1535,156,497,521,780,410,1195,413,1234,263,142,2903,796,74],[350,613,3175,1535,156,497,521,816,410,1195,449,1234,263,178,2903,796,110],[348,773,3175,1535,156,497,521,848,410,1195,481,1234,263,210,2903,796,142],[365,928,3175,1535,156,497,521,882,410,1195,515,1234,263,244,2903,796,176],[383,1030,3175,1535,156,497,521,915,410,1195,548,1234,263,277,2903,796,209,2734,734,30],[388,1063,3175,1535,156,497,521,946,410,1195,579,1234,263,308,2903,796,240,2734,734,61],[388,1075,3175,1535,156,497,521,983,410,1195,616,1234,263,345,2903,796,277,2734,734,98],[393,1103,3175,1535,156,410,1195,648,1234,263,377,2903,796,309,2734,734,130],[398,1143,3175,1535,156,410,1195,679,1234,263,408,2903,796,340,2734,734,161],[408,1180,3175,1535,156,410,1195,715,1234,263,444,2903,796,376,2734,734,197],[413,1213,3175,1535,156,410,1195,746,1234,263,475,2903,796,407,2734,734,228],[413,1223,3175,1535,156,410,1195,784,1234,263,513,2903,796,445,2734,734,266],[413,1223,3175,1535,156,410,1195,813,1234,263,542,2903,796,474,2734,734,295],[470,1193,3175,1535,156,410,1195,846,1234,263,575,2903,796,507,2734,734,328],[553,1143,3175,1535,156,410,1195,880,1234,263,609,2903,796,541,2734,734,362],[633,1085,3175,1535,156,410,1195,913,1234,263,642,2903,796,574,2734,734,395],[740,913,3175,1535,156,410,1195,947,1234,263,676,2903,796,608,2734,734,429],[863,700,3175,1535,156,410,1195,980,1234,263,709,2903,796,641,2734,734,462,0,0,7],[978,598,3175,1535,156,1234,263,741,2903,796,673,2734,734,494,2971,396,39],[1078,545,3175,1535,156,1234,263,775,2903,796,707,2734,734,528,2971,396,73,2088,333,29],[1125,525,3175,1535,156,1234,263,812,2903,796,744,2734,734,565,2971,396,110,2088,333,66],[1160,495,3175,1535,156,1234,263,843,2903,796,775,2734,734,596,2971,396,141,2088,333,97],[1193,453,3175,1535,156,1234,263,879,2903,796,811,2734,734,632,2971,396,177,2088,333,133],[1225,388,3175,1535,156,1234,263,911,2903,796,843,2734,734,664,2971,396,209,2088,333,165],[1243,353,3175,1535,156,1234,263,942,2903,796,874,2734,734,695,2971,396,240,2088,333,196],[1270,293,3175,1535,156,1234,263,977,2903,796,909,2734,734,730,2971,396,275,2088,333,231],[1278,275,3175,1535,156,2903,796,939,2734,734,760,2971,396,306,2088,333,262],[1278,273,3175,1535,156,2903,796,973,2734,734,794,2971,396,339,2088,333,295],[1278,273,3175,1535,156,2734,734,828,2971,396,373,2088,333,329,894,1355,16],[1278,278,3175,1535,156,2734,734,864,2971,396,409,2088,333,365,894,1355,52],[1298,295,3175,1535,156,2734,734,897,2971,396,442,2088,333,398,894,1355,85],[1385,338,3175,1535,156,2734,734,929,2971,396,474,2088,333,430,894,1355,117],[1588,380,3175,1535,156,2734,734,960,2971,396,505,2088,333,461,894,1355,148],[1728,380,3175,1535,156,2734,734,995,2971,396,540,2088,333,496,894,1355,183],[1838,375,3175,1535,156,2971,396,574,2088,333,530,894,1355,217],[1928,388,3175,1535,156,2971,396,606,2088,333,562,894,1355,249],[1928,388,3175,1535,156,2971,396,639,2088,333,595,894,1355,282],[2073,458,3175,1535,156,2971,396,675,2088,333,631,894,1355,318,0,0,0],[2098,475,3175,1535,156,2971,396,708,2088,333,664,894,1355,351,2818,1063,33],[2103,480,3175,1535,156,2971,396,743,2088,333,699,894,1355,386,2818,1063,68],[2110,480,3175,1535,156,2971,396,773,2088,333,729,894,1355,416,2818,1063,98],[2110,485,3175,1535,156,2971,396,809,2088,333,765,894,1355,452,2818,1063,134,2517,165,21],[2110,520,3175,1535,156,2971,396,840,2088,333,796,894,1355,483,2818,1063,165,2517,165,52,759,946,31],[2080,630,3175,1535,156,2971,396,874,2088,333,830,894,1355,517,2818,1063,199,2517,165,86,759,946,65],[2005,723,3175,1535,156,2971,396,909,2088,333,865,894,1355,552,2818,1063,234,2517,165,121,759,946,100],[1948,778,3175,1535,156,2971,396,940,2088,333,896,894,1355,583,2818,1063,265,2517,165,152,759,946,131],[1895,818,3175,1535,156,2971,396,975,2088,333,931,894,1355,618,2818,1063,300,2517,165,187,759,946,166],[1830,873,3175,1535,156,2088,333,962,894,1355,649,2818,1063,331,2517,165,218,759,946,197],[1748,923,3175,1535,156,2088,333,995,894,1355,682,2818,1063,364,2517,165,251,759,946,230],[1583,973,3175,1535,156,894,1355,719,2818,1063,401,2517,165,288,759,946,267],[1408,993,3175,1535,156,894,1355,753,2818,1063,435,2517,165,322,759,946,301],[1263,1018,3175,1535,156,894,1355,784,2818,1063,466,2517,165,353,759,946,332],[1105,1043,3175,1535,156,894,1355,818,2818,1063,500,2517,165,387,759,946,366],[1010,1063,3175,1535,156,894,1355,850,2818,1063,532,2517,165,419,759,946,398,2201,235,15],[983,1070,3175,1535,156,894,1355,886,2818,1063,568,2517,165,455,759,946,434,2201,235,51],[975,1078,3175,1535,156,894,1355,916,2818,1063,598,2517,165,485,759,946,464,2201,235,81],[960,1088,3175,1535,156,894,1355,953,2818,1063,635,2517,165,522,759,946,501,2201,235,118],[925,1093,3175,1535,156,894,1355,982,2818,1063,664,2517,165,551,759,946,530,2201,235,147],[878,1083,3175,1535,156,2818,1063,697,2517,165,584,759,946,563,2201,235,180],[808,1043,3175,1535,156,2818,1063,732,2517,165,619,759,946,598,2201,235,215],[738,968,3175,1535,156,2818,1063,769,2517,165,656,759,946,635,2201,235,252],[730,958,3175,1535,156,2818,1063,798,2517,165,685,759,946,664,2201,235,281],[723,958,3175,1535,156,2818,1063,834,2517,165,721,759,946,700,2201,235,317],[720,975,3175,1535,156,2818,1063,869,2517,165,756,759,946,735,2201,235,352],[700,1060,3175,1535,156,2818,1063,900,2517,165,787,759,946,766,2201,235,383],[688,1120,3175,1535,156,2818,1063,932,2517,165,819,759,946,798,2201,235,415],[688,1133,3175,1535,156,2818,1063,968,2517,165,855,759,946,834,2201,235,451],[693,1148,3175,1535,156,2818,1063,1000,2517,165,887,759,946,866,2201,235,483],[710,1178,3175,1535,156,2517,165,920,759,946,899,2201,235,516],[725,1200,3175,1535,156,2517,165,951,759,946,930,2201,235,547],[773,1200,3175,1535,156,2517,165,988,759,946,967,2201,235,584],[838,1173,3175,1535,156,759,946,1000,2201,235,617],[888,1140,3175,1535,156,2201,235,647],[970,1058,3175,1535,156,2201,235,685],[1145,968,3175,1535,156,2201,235,716],[1293,923,3175,1535,156,2201,235,749],[1458,903,3175,1535,156,2201,235,781],[1528,893,3175,1535,156,2201,235,817],[1608,838,3175,1535,156,2201,235,854],[1663,700,3175,1535,156,2201,235,883],[1770,473,3175,1535,156,2201,235,915],[1850,383,3175,1535,156,2201,235,950],[1993,283,3175,1535,156,2201,235,984],[2115,235,3175,1535,156],[2165,223,3175,1535,156],[2193,223,3175,1535,156],[2205,223,3175,1535,156],[2208,243,3175,1535,156],[2210,310,3175,1535,156],[2155,403,3175,1535,156],[2058,495,3175,1535,156],[1868,613,3175,1535,156],[1753,655,3175,1535,156],[1628,710,3175,1535,156,794,746,16],[1558,753,3175,1535,156,794,746,48],[1505,790,3175,1535,156,794,746,83,2134,1083,27],[1455,828,3175,1535,156,794,746,115,2134,1083,59,1468,800,23],[1433,850,3175,1535,156,794,746,148,2134,1083,92,1468,800,56],[1413,880,3175,1535,156,794,746,185,2134,1083,129,1468,800,93],[1390,930,3175,1535,156,794,746,214,2134,1083,158,1468,800,122],[1373,953,3175,1535,156,794,746,247,2134,1083,191,1468,800,155],[1313,973,3175,1535,156,794,746,282,2134,1083,226,1468,800,190],[1170,953,3175,1535,156,794,746,317,2134,1083,261,1468,800,225],[843,803,3175,1535,156,794,746,349,2134,1083,293,1468,800,257],[688,735,3175,1535,156,794,746,383,2134,1083,327,1468,800,291],[648,718,3175,1535,156,794,746,414,2134,1083,358,1468,800,322,1724,240,31],[640,715,3175,1535,156,794,746,448,2134,1083,392,1468,800,356,1724,240,65],[640,715,3175,1535,156,794,746,482,2134,1083,426,1468,800,390,1724,240,99,2521,726,16],[640,715,3175,1535,156,794,746,517,2134,1083,461,1468,800,425,1724,240,134,2521,726,51,0,0,13],[673,720,3175,1535,156,794,746,549,2134,1083,493,1468,800,457,1724,240,166,2521,726,83,189,832,45],[810,743,3175,1535,156,794,746,581,2134,1083,525,1468,800,489,1724,240,198,2521,726,115,189,832,77],[938,763,3175,1535,156,794,746,619,2134,1083,563,1468,800,527,1724,240,236,2521,726,153,189,832,115],[1125,785,3175,1535,156,794,746,648,2134,1083,592,1468,800,556,1724,240,265,2521,726,182,189,832,144],[1233,785,3175,1535,156,794,746,685,2134,1083,630,1468,800,594,1724,240,303,2521,726,220,189,832,182],[1313,743,3175,1535,156,794,746,715,2134,1083,659,1468,800,623,1724,240,332,2521,726,249,189,832,211],[1398,578,3175,1535,156,794,746,747,2134,1083,691,1468,800,655,1724,240,364,2521,726,281,189,832,243],[1460,435,3175,1535,156,794,746,782,2134,1083,726,1468,800,690,1724,240,399,2521,726,316,189,832,278,2237,489,19],[1518,328,3175,1535,156,794,746,813,2134,1083,757,1468,800,721,1724,240,430,2521,726,347,189,832,309,2237,489,50,0,0,0],[1568,278,3175,1535,156,794,746,847,2134,1083,791,1468,800,755,1724,240,464,2521,726,381,189,832,343,2237,489,84,896,884,34],[1630,225,3175,1535,156,794,746,883,2134,1083,827,1468,800,791,1724,240,500,2521,726,417,189,832,379,2237,489,120,896,884,70,0,0,0],[1685,203,3175,1535,156,794,746,917,2134,1083,861,1468,800,825,1724,240,534,2521,726,451,189,832,413,2237,489,154,896,884,104,569,1229,34],[1773,188,3175,1535,156,794,746,946,2134,1083,890,1468,800,854,1724,240,563,2521,726,480,189,832,442,2237,489,183,896,884,133,569,1229,63],[1813,188,3175,1535,156,794,746,983,2134,1083,927,1468,800,891,1724,240,600,2521,726,517,189,832,479,2237,489,220,896,884,170,569,1229,100,0,0,10],[1858,208,3175,1535,156,2134,1083,957,1468,800,921,1724,240,630,2521,726,547,189,832,509,2237,489,250,896,884,200,569,1229,130,503,701,40],[1890,260,3175,1535,156,2134,1083,991,1468,800,955,1724,240,664,2521,726,581,189,832,543,2237,489,284,896,884,234,569,1229,164,503,701,74],[1913,345,3175,1535,156,1468,800,989,1724,240,698,2521,726,615,189,832,577,2237,489,318,896,884,268,569,1229,198,503,701,108],[1920,428,3175,1535,156,1724,240,732,2521,726,649,189,832,611,2237,489,352,896,884,302,569,1229,232,503,701,142],[1925,445,3175,1535,156,1724,240,765,2521,726,682,189,832,644,2237,489,385,896,884,335,569,1229,265,503,701,175,2742,1373,29],[2005,478,3175,1535,156,1724,240,799,2521,726,716,189,832,678,2237,489,419,896,884,369,569,1229,299,503,701,209,2742,1373,63],[2148,493,3175,1535,156,1724,240,831,2521,726,748,189,832,710,2237,489,451,896,884,401,569,1229,331,503,701,241,2742,1373,95],[2255,493,3175,1535,156,1724,240,863,2521,726,780,189,832,742,2237,489,483,896,884,433,569,1229,363,503,701,273,2742,1373,127,1550,739,23,1749,953,12],[2340,518,3175,1535,156,1724,240,899,2521,726,816,189,832,778,2237,489,519,896,884,469,569,1229,399,503,701,309,2742,1373,163,1550,739,59,1749,953,48],[2373,533,3175,1535,156,1724,240,933,2521,726,850,189,832,812,2237,489,553,896,884,503,569,1229,433,503,701,343,2742,1373,197,1550,739,93,1749,953,82],[2410,560,3175,1535,156,1724,240,966,2521,726,883,189,832,845,2237,489,586,896,884,536,569,1229,466,503,701,376,2742,1373,230,1550,739,126,1749,953,115],[2460,588,3175,1535,156,1724,240,1000,2521,726,917,189,832,879,2237,489,620,896,884,570,569,1229,500,503,701,410,2742,1373,264,1550,739,160,1749,953,149],[2528,628,3175,1535,156,2521,726,949,189,832,911,2237,489,652,896,884,602,569,1229,532,503,701,442,2742,1373,296,1550,739,192,1749,953,181],[2603,673,3175,1535,156,2521,726,981,189,832,943,2237,489,684,896,884,634,569,1229,564,503,701,474,2742,1373,328,1550,739,224,1749,953,213],[2640,713,3175,1535,156,189,832,976,2237,489,717,896,884,667,569,1229,597,503,701,507,2742,1373,361,1550,739,257,1749,953,246],[2665,760,3175,1535,156,2237,489,753,896,884,703,569,1229,633,503,701,543,2742,1373,397,1550,739,293,1749,953,282,726,532,18],[2658,780,3175,1535,156,2237,489,785,896,884,735,569,1229,665,503,701,575,2742,1373,429,1550,739,325,1749,953,314,726,532,50],[2598,813,3175,1535,156,2237,489,819,896,884,769,569,1229,699,503,701,609,2742,1373,463,1550,739,359,1749,953,348,726,532,84],[2500,828,3175,1535,156,2237,489,851,896,884,801,569,1229,731,503,701,641,2742,1373,495,1550,739,391,1749,953,380,726,532,116],[2308,835,3175,1535,156,2237,489,887,896,884,837,569,1229,767,503,701,677,2742,1373,531,1550,739,427,1749,953,416,726,532,152],[2055,868,3175,1535,156,2237,489,920,896,884,870,569,1229,800,503,701,710,2742,1373,564,1550,739,460,1749,953,449,726,532,185],[1778,920,3175,1535,156,2237,489,954,896,884,904,569,1229,834,503,701,744,2742,1373,598,1550,739,494,1749,953,483,726,532,219],[1628,958,3175,1535,156,2237,489,985,896,884,935,569,1229,865,503,701,775,2742,1373,629,1550,739,525,1749,953,514,726,532,250],[1570,978,3175,1535,156,896,884,969,569,1229,899,503,701,809,2742,1373,663,1550,739,559,1749,953,548,726,532,284],[1523,975,3175,1535,156,896,884,1001,569,1229,931,503,701,841,2742,1373,695,1550,739,591,1749,953,580,726,532,316],[1468,930,3175,1535,156,569,1229,964,503,701,874,2742,1373,728,1550,739,624,1749,953,613,726,532,349],[1413,858,3175,1535,156,569,1229,998,503,701,908,2742,1373,762,1550,739,658,1749,953,647,726,532,383],[1380,800,3175,1535,156,503,701,940,2742,1373,795,1550,739,691,1749,953,680,726,532,416,1327,531,17],[1375,790,3175,1535,156,503,701,979,2742,1373,833,1550,739,729,1749,953,718,726,532,454,1327,531,55,2786,1067,34],[1375,780,3175,1535,156,2742,1373,865,1550,739,761,1749,953,750,726,532,486,1327,531,87,2786,1067,66],[1415,753,3175,1535,156,2742,1373,897,1550,739,793,1749,953,782,726,532,518,1327,531,119,2786,1067,98,339,1030,32,2585,1349,12],[1528,768,3175,1535,156,2742,1373,929,1550,739,825,1749,953,814,726,532,550,1327,531,151,2786,1067,130,339,1030,64,2585,1349,44],[1605,808,3175,1535,156,2742,1373,962,1550,739,858,1749,953,847,726,532,583,1327,531,184,2786,1067,163,339,1030,97,2585,1349,77],[1618,815,3175,1535,156,2742,1373,994,1550,739,890,1749,953,879,726,532,615,1327,531,216,2786,1067,195,339,1030,129,2585,1349,109],[1620,823,3175,1535,156,1550,739,924,1749,953,913,726,532,649,1327,531,250,2786,1067,229,339,1030,163,2585,1349,143],[1618,838,3175,1535,156,1550,739,959,1749,953,948,726,532,684,1327,531,285,2786,1067,264,339,1030,198,2585,1349,178],[1603,860,3175,1535,156,1550,739,990,1749,953,979,726,532,715,1327,531,316,2786,1067,295,339,1030,229,2585,1349,209],[1563,878,3175,1535,156,726,532,753,1327,531,354,2786,1067,333,339,1030,267,2585,1349,247],[1498,848,3175,1535,156,726,532,782,1327,531,383,2786,1067,362,339,1030,296,2585,1349,276],[1323,595,3175,1535,156,726,532,816,1327,531,417,2786,1067,396,339,1030,330,2585,1349,310],[1230,278,3175,1535,156,726,532,848,1327,531,449,2786,1067,428,339,1030,362,2585,1349,342],[1233,193,3175,1535,156,726,532,885,1327,531,486,2786,1067,465,339,1030,399,2585,1349,379,0,0,1],[1233,183,3175,1535,156,726,532,915,1327,531,516,2786,1067,495,339,1030,429,2585,1349,409,1212,167,31],[1233,183,3175,1535,156,726,532,950,1327,531,551,2786,1067,530,339,1030,464,2585,1349,444,1212,167,66],[1258,290,3175,1535,156,726,532,987,1327,531,588,2786,1067,567,339,1030,501,2585,1349,481,1212,167,103],[1253,418,3175,1535,156,1327,531,619,2786,1067,598,339,1030,532,2585,1349,512,1212,167,134,2228,728,22],[1205,503,3175,1535,156,1327,531,650,2786,1067,629,339,1030,563,2585,1349,543,1212,167,165,2228,728,53],[1108,550,3175,1535,156,1327,531,683,2786,1067,662,339,1030,596,2585,1349,576,1212,167,198,2228,728,86,2442,192,21],[963,548,3175,1535,156,1327,531,719,2786,1067,698,339,1030,632,2585,1349,612,1212,167,234,2228,728,122,2442,192,57],[828,523,3175,1535,156,1327,531,750,2786,1067,729,339,1030,663,2585,1349,643,1212,167,265,2228,728,153,2442,192,88],[658,503,3175,1535,156,1327,531,784,2786,1067,763,339,1030,697,2585,1349,677,1212,167,299,2228,728,187,2442,192,122],[580,490,3175,1535,156,1327,531,817,2786,1067,796,339,1030,730,2585,1349,710,1212,167,332,2228,728,220,2442,192,155],[563,485,3175,1535,156,1327,531,851,2786,1067,830,339,1030,764,2585,1349,744,1212,167,366,2228,728,254,2442,192,189],[558,493,3175,1535,156,1327,531,883,2786,1067,862,339,1030,796,2585,1349,776,1212,167,398,2228,728,286,2442,192,221],[523,618,3175,1535,156,1327,531,918,2786,1067,897,339,1030,831,2585,1349,811,1212,167,433,2228,728,321,2442,192,256],[465,778,3175,1535,156,1327,531,953,2786,1067,932,339,1030,866,2585,1349,846,1212,167,468,2228,728,356,2442,192,291],[403,913,3175,1535,156,1327,531,983,2786,1067,962,339,1030,896,2585,1349,876,1212,167,498,2228,728,386,2442,192,321],[358,1010,3175,1535,156,2786,1067,996,339,1030,930,2585,1349,910,1212,167,532,2228,728,420,2442,192,355],[350,1025,3175,1535,156,339,1030,964,2585,1349,944,1212,167,566,2228,728,454,2442,192,389],[348,1035,3175,1535,156,339,1030,996,2585,1349,976,1212,167,598,2228,728,486,2442,192,421],[338,1068,3175,1535,156,1212,167,630,2228,728,518,2442,192,453],[323,1113,3175,1535,156,1212,167,667,2228,728,555,2442,192,490],[305,1143,3175,1535,156,1212,167,699,2228,728,587,2442,192,522],[298,1153,3175,1535,156,1212,167,732,2228,728,620,2442,192,555],[310,1110,3175,1535,156,1212,167,766,2228,728,654,2442,192,589],[375,1003,3175,1535,156,1212,167,798,2228,728,686,2442,192,621],[458,938,3175,1535,156,1212,167,832,2228,728,720,2442,192,655,1456,876,33],[588,933,3175,1535,156,1212,167,865,2228,728,753,2442,192,688,1456,876,66],[805,1003,3175,1535,156,1212,167,899,2228,728,787,2442,192,722,1456,876,100],[1103,1060,3175,1535,156,1212,167,932,2228,728,820,2442,192,755,1456,876,133,221,852,29],[1515,1073,3175,1535,156,1212,167,966,2228,728,854,2442,192,789,1456,876,167,221,852,63],[1873,1030,3175,1535,156,1212,167,999,2228,728,887,2442,192,822,1456,876,200,221,852,96],[2075,935,3175,1535,156,2228,728,920,2442,192,855,1456,876,233,221,852,129],[2148,878,3175,1535,156,2228,728,956,2442,192,891,1456,876,269,221,852,165],[2215,768,3175,1535,156,2228,728,992,2442,192,927,1456,876,305,221,852,201,0,0,15],[2235,698,3175,1535,156,2442,192,955,1456,876,333,221,852,229,1883,517,43],[2245,673,3175,1535,156,2442,192,988,1456,876,366,221,852,262,1883,517,76],[2275,653,3175,1535,156,1456,876,401,221,852,297,1883,517,111],[2313,638,3175,1535,156,1456,876,432,221,852,328,1883,517,142,582,1061,31],[2335,638,3175,1535,156,1456,876,468,221,852,364,1883,517,178,582,1061,67],[2338,638,3175,1535,156,1456,876,501,221,852,397,1883,517,211,582,1061,100],[2190,703,3175,1535,156,1456,876,535,221,852,431,1883,517,245,582,1061,134],[1910,788,3175,1535,156,1456,876,566,221,852,462,1883,517,276,582,1061,165],[1590,813,3175,1535,156,1456,876,600,221,852,496,1883,517,310,582,1061,199],[1525,823,3175,1535,156,1456,876,634,221,852,530,1883,517,344,582,1061,233],[1513,823,3175,1535,156,1456,876,668,221,852,564,1883,517,378,582,1061,267],[1508,823,3175,1535,156,1456,876,700,221,852,596,1883,517,410,582,1061,299],[1500,835,3175,1535,156,1456,876,732,221,852,628,1883,517,442,582,1061,332,751,275,27],[1468,865,3175,1535,156,1456,876,766,221,852,662,1883,517,476,582,1061,365,751,275,60],[1420,903,3175,1535,156,1456,876,800,221,852,696,1883,517,510,582,1061,399,751,275,94],[1408,910,3175,1535,156,1456,876,834,221,852,730,1883,517,544,582,1061,433,751,275,128],[1400,905,3175,1535,156,1456,876,867,221,852,763,1883,517,577,582,1061,466,751,275,161],[1463,788,3175,1535,156,1456,876,899,221,852,795,1883,517,609,582,1061,498,751,275,193],[1645,655,3175,1535,156,1456,876,937,221,852,833,1883,517,647,582,1061,536,751,275,231],[1780,588,3175,1535,156,1456,876,965,221,852,861,1883,517,675,582,1061,564,751,275,259],[1865,550,3175,1535,156,1456,876,1001,221,852,897,1883,517,711,582,1061,600,751,275,295],[1878,545,3175,1535,156,221,852,932,1883,517,746,582,1061,635,751,275,330],[1883,545,3175,1535,156,221,852,969,1883,517,783,582,1061,672,751,275,367],[1880,548,3175,1535,156,221,852,996,1883,517,810,582,1061,699,751,275,394],[1833,568,3175,1535,156,1883,517,846,582,1061,735,751,275,430],[1688,608,3175,1535,156,1883,517,877,582,1061,766,751,275,461],[1330,553,3175,1535,156,1883,517,911,582,1061,800,751,275,495],[860,408,3175,1535,156,1883,517,944,582,1061,833,751,275,528],[673,358,3175,1535,156,1883,517,978,582,1061,867,751,275,562,0,0,18],[598,338,3175,1535,156,1883,517,1010,582,1061,899,751,275,594,2252,1242,50,0,0,18],[543,303,3175,1535,156,582,1061,933,751,275,628,2252,1242,84,2547,1114,52],[533,290,3175,1535,156,582,1061,966,751,275,661,2252,1242,117,2547,1114,85],[538,275,3175,1535,156,582,1061,999,751,275,694,2252,1242,150,2547,1114,118],[568,253,3175,1535,156,751,275,726,2252,1242,182,2547,1114,150],[643,233,3175,1535,156,751,275,760,2252,1242,216,2547,1114,184],[728,270,3175,1535,156,751,275,794,2252,1242,250,2547,1114,218],[808,410,3175,1535,156,751,275,831,2252,1242,287,2547,1114,255,0,0,6],[820,533,3175,1535,156,751,275,861,2252,1242,317,2547,1114,285,2735,691,36],[785,653,3175,1535,156,751,275,896,2252,1242,352,2547,1114,320,2735,691,71],[735,743,3175,1535,156,751,275,927,2252,1242,383,2547,1114,351,2735,691,102],[685,843,3175,1535,156,751,275,964,2252,1242,420,2547,1114,388,2735,691,139],[663,928,3175,1535,156,751,275,996,2252,1242,452,2547,1114,420,2735,691,171],[663,983,3175,1535,156,2252,1242,484,2547,1114,452,2735,691,203],[663,1010,3175,1535,156,2252,1242,519,2547,1114,487,2735,691,238],[663,1020,3175,1535,156,2252,1242,555,2547,1114,523,2735,691,274],[715,1020,3175,1535,156,2252,1242,584,2547,1114,552,2735,691,303],[873,993,3175,1535,156,2252,1242,617,2547,1114,585,2735,691,336,0,0,5],[1113,948,3175,1535,156,2252,1242,654,2547,1114,622,2735,691,373,1890,1139,42,0,0,30,0,0,15],[1333,918,3175,1535,156,2252,1242,683,2547,1114,651,2735,691,402,1890,1139,71,2250,688,59,1531,899,44],[1505,915,3175,1535,156,2252,1242,718,2547,1114,686,2735,691,437,1890,1139,106,2250,688,94,1531,899,79],[1620,923,3175,1535,156,2252,1242,754,2547,1114,722,2735,691,473,1890,1139,142,2250,688,130,1531,899,115,0,0,19],[1760,933,3175,1535,156,2252,1242,783,2547,1114,751,2735,691,502,1890,1139,171,2250,688,159,1531,899,144,560,1219,48],[1903,970,3175,1535,156,2252,1242,818,2547,1114,786,2735,691,537,1890,1139,206,2250,688,194,1531,899,179,560,1219,83],[2158,1083,3175,1535,156,2252,1242,849,2547,1114,817,2735,691,568,1890,1139,237,2250,688,225,1531,899,210,560,1219,114,0,0,23],[2390,1228,3175,1535,156,2252,1242,881,2547,1114,849,2735,691,600,1890,1139,269,2250,688,257,1531,899,242,560,1219,146,392,544,55],[2398,1233,3175,1535,156,2252,1242,917,2547,1114,885,2735,691,636,1890,1139,305,2250,688,293,1531,899,278,560,1219,182,392,544,91,524,1352,29],[2398,1233,3175,1535,156,2252,1242,949,2547,1114,917,2735,691,668,1890,1139,337,2250,688,325,1531,899,310,560,1219,214,392,544,123,524,1352,61],[2398,1233,3175,1535,156,2252,1242,982,2547,1114,950,2735,691,701,1890,1139,370,2250,688,358,1531,899,343,560,1219,247,392,544,156,524,1352,94],[2398,1233,3175,1535,156,2547,1114,984,2735,691,735,1890,1139,404,2250,688,392,1531,899,377,560,1219,281,392,544,190,524,1352,128],[2398,1233,3175,1535,156,2547,1114,1020,2735,691,771,1890,1139,440,2250,688,428,1531,899,413,560,1219,317,392,544,226,524,1352,164],[2398,1233,3175,1535,156,2735,691,803,1890,1139,472,2250,688,460,1531,899,445,560,1219,349,392,544,258,524,1352,196],[2398,1233,3175,1535,156,2735,691,834,1890,1139,503,2250,688,491,1531,899,476,560,1219,380,392,544,289,524,1352,227],[2398,1233,3175,1535,156,2735,691,870,1890,1139,539,2250,688,527,1531,899,512,560,1219,416,392,544,325,524,1352,263],[2398,1233,3175,1535,156,2735,691,903,1890,1139,572,2250,688,560,1531,899,545,560,1219,449,392,544,358,524,1352,296],[2163,1198,3175,1535,156,2735,691,937,1890,1139,606,2250,688,594,1531,899,579,560,1219,483,392,544,392,524,1352,330],[2023,1188,3175,1535,156,2735,691,969,1890,1139,638,2250,688,626,1531,899,611,560,1219,515,392,544,424,524,1352,362,0,0,23],[1815,1163,3175,1535,156,2735,691,1003,1890,1139,672,2250,688,660,1531,899,645,560,1219,549,392,544,458,524,1352,396,2057,488,57],[1645,1128,3175,1535,156,1890,1139,705,2250,688,693,1531,899,678,560,1219,582,392,544,491,524,1352,429,2057,488,90,0,0,14],[1580,1105,3175,1535,156,1890,1139,738,2250,688,726,1531,899,711,560,1219,615,392,544,524,524,1352,462,2057,488,123,677,913,47]]

        # add a zero state for derivative calculations
        states = [GameState(0,0,0,0,0,0,0,0,0,0,0,())]

        for o in observations:

            s = states[-1]
            a = torch.tensor([o[0]-s[0], o[1]-s[1]])
            
            c = self._update_old_cursor(s[0:8], a)[0].tolist()

            states.append(GameState(*c, o[2], o[3], o[4], tuple(o[5:])))

        # remove the zero state because it is invalid and early states that have noisy derivatives
        return states[3:]

class MyAcrobot(GymEnvironment):

    def __init__(self) -> None:
        
        environment       = GymEnvironment('Acrobot-v1')
        reward            = LambdaReward(lambda s: float(-(np.cos(s[0]) + np.cos(s[1] + s[0])) - 1))
        observation_space = environment.observation_space

        super().__init__(RewardEnvironment(environment, reward), observation_space)

class MyThesis(GymEnvironment):

    def __init__(self) -> None:

        environment       = ThesisDynamics()
        reward            = RandomReward()
        observation_space = Box(low=-float('inf'), high=float('inf'), shape=(9,))
        observer          = ValueFeatures()

        super().__init__(RewardEnvironment(environment, reward), observation_space, observer)

register(
    id='MyAcrobot-v1',
    entry_point='combat.domains.thesis.environments:MyAcrobot',
)

register(
    id='MyThesis-v0',
    entry_point='combat.domains.thesis.environments:MyThesis',
)